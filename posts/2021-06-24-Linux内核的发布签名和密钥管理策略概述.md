---
title: Linux内核的发布签名和密钥管理策略评审
date: 2021-06-24
---

# Linux内核的发布签名和密钥管理策略评审

> 原文：https://ostif.org/a-review-of-the-linux-kernels-release-signing-and-key-management-policies/
>
> 本译文以CC-BY-SA 4.0许可下发布
> 2021年06月24日

原文发布时间：2021年06月23日

[Linux基金会](https://www.Linux基金会.org)寻求对内核团队的发布签名过程以及处理签名密钥的策略和过程的评审。与[OSTIF](https://ostif.org)（Open Source Technology Improvement Fund，开源技术促进基金会）一起，[Trail of Bits](https://www.trailofbits.com/)被选为项目负责人，并进行了投入两人、为期一周的评审。

与大多数OSTIF项目不同的是，本次评审不涉及代码，而是回顾相关策略与过程，旨在确定世界上最关键基础设施之一的密钥处理和密钥签名过程中的潜在痛点。因此没有漏洞CVE或CID编号。

特别感谢Greg Kroah-Hartman和Konstantin Ryabitsev参与访谈，帮助评审人员厘清文件，并留出时间讨论研究人员的发现。谢谢Linux基金会的David A. Wheeler和Mike Dolan帮助推动这个项目。感谢Jim Miller、Mike Martel、Opal Wright和Cara Pearson在本次评审中所做的工作以及撰写本报告。最后要特别感谢Trail of Bits的Dan Guido，感谢他与我们一起改进关键的开源基础设施。

# 结论

本次评审提出了七条建议，这些建议有助于提高Linux内核的安全方面和使用签名密钥方面的健壮性。此外，Trail of Bits表示，需要现行程序与政策的更全面和最新的文档，以帮助世界各地的组织切实理解当前的策略。

## 未强制关键个人对GPG和SSH使用智能卡

拥有Linux内核存储库提交权限的个人，未被要求将用于GPG或SSH的私钥存储在单独的智能卡设备上，例如Nitrokey或Yubikey。

### 建议的措施

短期内，要求能够访问重要存储库或系统的个人使用智能卡设备存储敏感的密钥。如果不可行，考虑使用替代机制，如TPM，来保护敏感的密钥。

## 推荐的智能卡无需触摸激活

Linux基金会建议内核开发人员使用智能卡，特别是Nitrokeys来保护他们的私钥。Linux基金会建议的Nitrokeys未要求用户在使用智能卡功能时执行任何物理操作。而有其他设备可以配置为要求用户在智能卡操作发生之前触摸设备。因此在插入电脑时，Nitrokey仅受到密码（PIN）的保护。

虽然触摸激活功能不能阻止所有类型的攻击，例如替换磁盘上的二进制文件（针对GPG和SSH）或利用会话劫持的攻击，但它可以防止所有类型的非复杂攻击，并改善用户的安全态势。

### 建议的措施

考虑强制使用需要物理触摸的智能卡设备来验证每个智能卡操作。如果这不可行，请添加指导，建议只有在需要智能卡完成操作时才将智能卡物理连接到工作站，这将有助于防止攻击者在用户不知情的情况下使用连接的智能卡设备。

### 回应

Linux基金会内核团队成员表示，由于带有触摸激活功能的Yubikey为非开源，因此不可能将其用于保护关键基础设施的安全性。但是他们会考虑更新策略，建议管理员在计算机上不使用当前的Nitrokey时断开物理连接。从长远来看，我们希望在触摸激活设备中能有更多的开源软件选项。

## 缺乏密钥管理策略和程序的文档

对于密钥撤销、生成、轮换或其他密钥管理任务，没有集中、权威的文档来规定策略和程序。缺乏此类文档将导致用户和管理员在执行常规和紧急密钥管理任务时更容易犯严重错误。

### 建议的措施

短期内，与管理员和开发人员一起记录当前的流程和策略，并将这些信息汇编成一组可以根据需要进行更新的文档。

长期来看，需要定期审查策略和程序，评估其适用性和适当性。并随着策略和程序的变化及时更新文档。

### 回应

Linux基金会内核团队成员已经确认需要改进文档，以减少出错的机会并优化事件响应。

## 缺少公钥认证资源

为了验证内核更新的内容，git树中的每个提交都会生成一个已签名的标记，并且每个版本都伴随着对发布的tar包的签名。Linux开发人员的公钥以及构成信任网的相关密钥签名，都是从单一位置管理的。对`git.kernel.org`服务器的破坏将允许攻击者向用户提供一个不受内核开发人员控制的公钥网络，使他们能够“发布”恶意的、可通过攻击者公钥验证的内核版本。

***公钥系统的信任引导是一个很难解决的问题，而且肯定不是Linux内核独有的问题。任何依赖数字签名进行验证的软件必须首先通过确保用户拥有正确的公钥来“引导”信任。这产生了一个在一般情况下很难解决的循环依赖问题。***

Linux基金会有其独特能力以缓解这个问题。由于Linux的社区和商业支持，内核开发人员有许多方法为重要的开发人员分发PGP密钥指纹。密钥指纹可以包含在会议幻灯片中，定期发布在`lwn.net`等新闻网站上，包含在电子邮件签名中，或者发布在Linux基金会合作伙伴（如Red Hat或IBM）维护的网站上。托管在`kernel.org`基础设施上的密钥指纹可以针对多个公共源进行验证，从而降低恶意密钥被信任的可能性。

### 建议的措施

短期内，找出有效的方法广泛宣传开发者的密钥指纹。这可能包括在电子邮件签名中添加密钥指纹，定期在邮件列表中发布，或在会议演示中展示它们。

长期而言，继续通过多个渠道宣传密钥，并与合作伙伴合作，提供可访问的公钥证实来源。

### 回应

Linux基金会内核团队成员对短期和长期建议都表示了兴趣。

## 在信任网中使用旧的公钥算法和标准

内核开发人员使用的PGP密钥长度和算法有很大不同。RSA是最常用的算法，其次是DSA和椭圆曲线算法。针对因式分解和离散对数的攻击算法的工作量复杂度差异很大，且这些算法经常受到新的微妙失效模式的影响。Trail of Bits通常建议尽可能远离RSA，转而使用椭圆曲线算法。

由于这些密钥用于验证最终合并到内核中的代码，所以更应该使用现代方法。使用单一的现代算法和密钥大小将会有助于减小高水平攻击者的攻击面。

### 建议的措施

短期内，选择单一算法和密钥尺寸，将新密钥合并到内核信任网络和PGP密钥库中。当前的内核开发人员指南建议使用ECDSA或Ed25519密钥。要求所有新密钥都符合此指南，这将是朝着标准化方向迈出的有效一步。

长期而言，与开发人员合作，逐步用新的符合策略的密钥替换旧的RSA和传统的DSA密钥，并将它们集成到内核信任网络中。确定一个“截止日期”，在此日期之前所有钥匙都应完成切换。

## 缺乏外部完整性验证机制

内核发布涉及一系列步骤，例如合并Git存储库中的变更、推送标记以及生成tar包以供发布。目前，步骤完整性的验证很大程度上依赖于更广泛的社区来注意不正确或恶意的行为。虽然这可能是有效的，但是附加的完整性检查将大大提高系统的健壮性，并有助于减少对基础设施的隐性信任。

### 建议的措施

短期内，考虑发布可以将tar包内容与打标记的Git版本内容进行比较的工具，以及能够确保对`kernel.org`上托管的关键存储库的所有提交都使用预期身份进行签名的工具。还可以考虑在`kernel.org`系统上运行验证器。

从长远来看，考虑提倡有兴趣的独立方运行这些验证工具，以支持更广泛的Linux内核社区的完整性验证机制。

## 缺少SSH密钥轮换

目前，用于访问`kernel.org`基础设施的SSH密钥是静态的。由于SSH密钥通常可用于访问其他系统，因此它们经常成为攻击者的目标。当前配置下，取得单个开发人员的SSH密钥可能允许无限期地访问kernel.org资源。

密钥轮换计划可以减轻SSH密钥泄露对`kernel.org`系统的影响。此外，有了一个可以轮换SSH密钥的系统，Linux基金会可以更快地对攻击做出响应。

### 建议的缓解措施

短期内，制定一个适当的密钥轮换时间表，以限制遭泄露的SSH密钥的影响。

长期而言，确保遵循密钥轮换策略，并确保管理员在密钥轮换过程中进行实践。这将限制密钥泄露带来的威胁，并确保管理员能够在发现泄露时快速切换密钥。

---

[《Linux内核发布签名的安全评估》报告全文PDF，作者Trail of Bits。](https://ostif.org/wp-content/uploads/2021/06/Linux-Kernel-Release-Signing-OSTIF-and-Trail-of-Bits.pdf)
